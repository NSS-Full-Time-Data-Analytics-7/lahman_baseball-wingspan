--Question 8. Using the attendance figures from the homegames table, find the teams and parks which had the top 5 average attendance per game in 2016 
--(where average attendance is defined as total attendance divided by number of games). Only consider parks where there were at least 10 games played. 
--Report the park name, team name, and average attendance. 
--Repeat for the lowest 5 average attendance.

SELECT*,
FROM Homegames

SELECT*
FROM teams

--BEST VISUAL OF THE DATA--
--CORRECT:
SELECT p.park_name,t.name as team_name,h.team as team_id, h.park as park_id, (SUM(h.attendance)/SUM(h.games)) AS avg_attendance, h.year
FROM homegames as h
    INNER JOIN parks as p USING (park)
	INNER JOIN teams as t ON h.team=t.teamid
WHERE h.year = 2016
GROUP BY p.park_name,t.name,h.team, h.park, h.year
HAVING COUNT(games)>=10
ORDER BY avg_attendance DESC


--FINAL--

-- TOP 5--
SELECT p.park_name,t.name as team_name,(SUM(h.attendance)/SUM(h.games)) AS avg_attendance
FROM homegames as h
    INNER JOIN parks as p USING (park)
	INNER JOIN teams as t ON h.team=t.teamid
WHERE h.year = 2016
GROUP BY p.park_name,t.name
HAVING COUNT(games)>=10
ORDER BY avg_attendance DESC
LIMIT 5

--BOTTOM 5
SELECT p.park_name,t.name as team_name,(SUM(h.attendance)/SUM(h.games)) AS avg_attendance
FROM homegames as h
    INNER JOIN parks as p USING (park)
	INNER JOIN teams as t ON h.team=t.teamid
WHERE h.year = 2016
GROUP BY p.park_name,t.name
HAVING COUNT(games)>=10
ORDER BY avg_attendance
LIMIT 5



